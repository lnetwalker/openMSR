


                        S P S - SIMULATOR V 1.7

                             vom  26.11.93

               (c) 1990-1993 by Stephan Kauth COMTOOLS

      1) šberblick

         Der SPS - Simulator ist eine Entwicklungsumgebung zur Er-
         stellung Speicherprogramierbarer Steuerungen. Er enth„lt
         alle notwendigen Funktionen um eine:
              1 - AWL zu editieren
              2 - AWL zu archivieren (laden,speichern,drucken)
              3 - AWL zu testen

         Verfgt man ber eine handelsbliche PIO - Karte ist es
         m”glich eine Steuerung mit dem PC aufzubauen.

         Dank unserem TSR-Programm RUN_SPS k”nnen Sie mit Ihrem PC
         wie gewohnt arbeiten, w„hrend im Hintergrund Ihre Steuerung
         l„uft. šber RUN_SPS erfahren sie weitere Details in der
         Documentation RUN_SPS.DOC.

         Diese Dokumentation k”nnen Sie natrlich auch ausdrucken.
         Die einfachste M”glichkeit dazu ist der PRINT Befehl:
         PRINT SPS.DOC .

      2) Bedienung

         Nach Start des Programmes durch Eingabe von SPS und Be-
         t„tigung der RETURN - Taste meldet sich das Programm
         mit dem Titelbild und der Versionsangabe. Diese Meldung
         wird nach kurzer Zeit gel”scht und es erscheint in der
         1.Zeile des Bildschirms das Hauptmen.

         Durch Eingabe der farbig abgesezten Anfangsbuchstaben
         oder der Pfeiltasten und RETURN oder der Maus  
         kann der Anwender zwischen folgenden Punkten w„hlen:

              - <F>ile :  enth„lt alle Menpunkte um eine
                          AWL zu
                              - l”schen
                              - laden
                              - speichern
                              - ausdrucken
                          sowie:
                              - Directory anzeigen
                              - Standartverzeichnis wechseln
                              - Ausflug in das Betriebssystem
                                machen

              - <E>dit :  erlaubt das Erstellen und ndern einer AWL

              - <R>un :   Starten einer AWL

              - <D>ocu :  Lesen der bzw. Suchen in der Online Dokumentation

              - <Q>uit :  Beenden der Entwicklungsumgebung

         Bei Verwendung der Maus entspricht die linke Taste RETURN
         die rechte Taste ESC (mittlere Taste wird nicht verwendet !)
         Die Maus funktioniert jedoch nur im Menue Fileservice und
         im Hauptmenue. 

      2.1 Erkl„rung der Menpunkte

          Bei Auswahl der Menpunkte wird ein Fenster ge”ffnet.
          Im oberen Rahmen des Fensters steht in eckigen Klammern
          der Name des Menpunktes, im unteren Rahmen in spitzen
          Klammern wie man diesen Menpunkt beenden kann.

      2.1.1 Der Menpunkt FILE

          Nach Eingabe von F im Hauptmen erscheint das Auswahlmen
          FILE. Sie k”nnen jetzt wieder durch Eingabe des farbig unter-
          legten Anfangsbuchstaben ,der Pfeiltasten und RETURN oder
          der Maus zwischen folgenden Punkten w„hlen :
               N - Normieren des Speichers
                   ( d.h. L”schen der aktuellen AWL im Speicher )

               L - Laden einer AWL von Disk / Platte

               S - Sichern der aktuellen AWL auf Disk/Platte

               A - Ausdruck der im Speicher befindlichen AWL
                   auf einem STAR NL 10 oder kompatiblen Drucker

               D - Directory anzeigen

               C - wechseln des Standartdirectories

               O - Ausflug in das Betriebssystem
                   ( durch Eingabe von EXIT zurck )


          Alle Pfad- und Dateiangabenn im Men FILE mssen in der
          MS-DOS Syntax angegeben werden.
          Wird kein Pfad angegeben bezieht sich der Befehl auf das
          aktuelle Laufwerk/ bzw. Pfad.
          Wird keine Dateinamenserwiterung angegeben wird automatisch
          .SPS angeh„ngt.

      2.1.2 Der Menpkt EDIT

          Nach Eingabe von E aus dem Hauptmen befindet man sich
          im Editorfenster.

          Es kann nun eine AWL erstellt oder ge„ndert werden.

          Aufbau einer Zeile der AWL:
              1. Zeilennummer:
                 Der Editor schl„gt jeweils die n„chste aktuelle
                 Zeilennummer vor. Will man diese bernehmen, so
                 muá keine neue Zeilennummer angegeben werden.
                 Will man jedoch eine bestehende Zeile „ndern
                 so muá hier die entsprechende Zeilennummer ange-
                 geben werden und die Zeile berschrieben werden.

              2. Operation (max 3Stellig) enth„lt einen gltigen
                 Befehl.

              3. Operand (1 stellig ) enth„lt einen gltigen Operanden

              4. Parameter ( max 65535 ) enth„lt den Parameter eines
                 Befehls oder die Nummer eines Operanden.

              5. Kommentar ( max 22 Stellen ) ist optional und nur zu
                 Dokumentationszwecken.


          Alle Komponenten einer Zeile werden ohne Zwischenr„ume
          direkt eingegeben.
          Bsp.: 18 ue1Eingang 1 = Starttaste

          Diese Eingabe wird vom Editor wie folgt umgeformt:

                18 U   E     1 Eingang 1 = Starttaste
          Bedeutung:
                               Kommentar
                             Parameter
                       Operand
                   Operation
                vorgegebene Zeilennummer

          Jede Zeile wird mit RETURN bzw. ENTER abgeschlossen.
          Solange eine Zeile nicht abgeschlossen ist kann sie
          mit BACKSPACE korrigiert werden.
          Nach Abschluá einer Zeile kann diese nur durch
          šberschreiben ge„ndert werden.

          Folgende Tasten haben im Editor eine Bedeutung:

          f1: Einfgen einer Zeile in die AWL. Nach Eingabe der
              Zeilennummer wird an dieser Stelle eine Zeile ein-
              gefgt deren Inhalt der NOP Befehl ( No Operation )
              ist. Diese Zeile kann durch berschreiben ge„ndert
              werden.

          f2: L”schen einer Zeile in der AWL . Nach Angabe der
              Zeilennummer wird diese Zeile gel”scht, alle nach-
              folgenden zeilen werden um eine Position verschoben.

          Die Sprungziele bei den Sprungbefehlen werden automatisch
          angepaát.

          CURSOR UP/DOWN Zeilenweises bl„ttern durch die AWL

          PAGE   UP/DOWN Seitenweises bl„ttern durch die AWL

          BACKSPACE Zeichen links vom Cursoor l”schen

          RETURN Zeile abschlieáen

          ESC Editor verlassen.

      2.1.4 Der Menpunkt RUN

          Durch Eingabe von R im Hauptmen wird eine AWL gestartet.
          Auf dem Bildschirm erscheint ein Fenster in dem der Zustand
          aller
               - MARKER
               - TIMER
               - COUNTER
               - EINGNGE
               - AUSGNGE angezeigt wird,
          sowie die Information ob die Steuerung INTERN oder EXTERN
          arbeitet sowie die sog. Zykluszeit. Dise gibt an, wie lange
          ein AWL Durchlauf durchschnittlich dauert.
          Die Zykluszeit wird auch als Kommentar in die 1. Zeile der
          AWL eingesezt. An Hand der Zykluszeit kann die Verz”gerungs-
          zeit der Timer berechnet werden.

          Eine AWL wird solange immer wieder abgearbeitet bis ESC be-
          t„tigt wird.

          Folgende Tasten haben eine Bedeutung:

          f1-f8 Bei Interner Steuerung wird mit jedem Tastendruck der
                Zustand des jeweiligen Einganges getoggelt.

          f9    Umschaltung INTERN /EXTERN
                Bei Externer Betriebsart wird ber eine angeschlossene
                PIO gearbeitet.

          f10   Durch f10 wird in den Grafikmodus geschaltet und der
                Zustand der Ein- und Ausg„nge im Zeitdiagramm dargestellt.
                Zus„tzlich wird eine Zeitachse eingezeichnet, bei der jeder
                senkrechte Strich einem AWL Durchlauf entspricht d. h.
                der Zykluszeit. Mit der Taste <P> kann eine Hardcopy auf
                einem Grafikf„higen Drucker ausgegeben werden, mit F10
                wird wieder in die Normaldarsdtellung umgeschaltet.
                Fr die Darstellung im Grafikmodus muá eine CGA , EGA
                oder HERCULES Grafikkarte installiert sein.


      2.1.5 Menupunkt DOCU

          Durch D im Hauptmenu bzw. die Maus oder die Cursortasten wird
          die Online Dokumentation aufgerufen. Mit PAGE UP bzw. PAGE DOWN
          koennen Sie nun durch die Dokumentation blaettern, oder ueber
          die Taste s die Suchfunktion aktivieren. Mittels ESC verlassen
          Sie die Online Dokumentation und gelangen zuruck ins Hauptmenue.
          Ueber die Suchfunktion koennen Sie nach beliebigen Woerten bzw.
          Wortteilen suchen. Die Schreibweise (gross/klein) wird dabei
          ignoriert. Die Suche beginnt immer am Dokumentanfang und wird
          zum Ende hin fortgesetzt. Falls die Suche erfolgreich war koennen
          Sie ueber ESC die Suche beenden oder mit einer beliebigen Taste
          fortsetzen. Die Dokumentations-Datei heisst SPS.DOC und muss sich
          in dem Verzeichnis befinden aus dem SPS.EXE gestartet wurde.
          Da es sich bei der DOC Datei um eine reine ASCII - Datei handelt
          koennen Sie selbst die Dokumentation erweitern. Dazu benoetigen
          Sie lediglich einen Editor der ASCII Dateien erzeugen kann.
          (z.B.: Edit ). Dabei muessen Sie jedoch die Zeilenlaenge von
          max. 76 Zeichen beachten !!!!

      2.1.6 Menpunkt QUIT

          Durch Q im Hauptmen wird die Entwicklungsumgebung verlassen
          Befindet sich zu diesem Zeitpunkt eine AWL im Speicher, die
          noch nicht gespeichert wurde, haben sie die M”glichkeit
          ber den Menpunkt File diese ZU sichern.


      3. Die Befehle der AWL:

           U    der Akkuinhalt wird mit angeg. Oper. UND verknpft
           UN   der negierte Akkuinhalt wird mit dem angegeb. Oper.
                verknpft.
           U(   der Akkuinkalt wird mit dem log. Ergebnis des Klammer-
                ausdruckes und verkn.
           UN(  der neg. Akkkuinhalt wird mit Ergebnis des Klammeraus-
                druckes UND verknpft.

           O    der Akkuinhalt wird mit Oper. ODER verk.
           ON   Siehe oben jedoch ODER Verknpfung.
           O(
           ON(
           =    Zuweisung, damit kann einem Marker oder Timer der Akku-
                inhalt zugewiesen werden.
           =N   wie oben, jedoch der negierte Akkuinhalt.
           S    damit kann ein Ausgang oder Merker auf 1 gesetzt werden
           R    damit kann ein Ausgang oder Merker auf 0 rckgesetzt werden
           J    unbedingter Sprung. Es wird immer an die Stelle gespprungen
                die als Parameter angegeben ist.
           JI   jump if- begingter Sprung der nur ausgefhrt wird wenn
                akkuinhalt 1 ist.
           TE   Timer einschaltverz”gert.
           ZR   Z„hler rckw„rts.
           K    Konstante fr Z„hler oder Timer
           NOP  No Operation
           EN   Ende der AWL.

           Siehe  Beispiele!

      3.1 Technische Daten des SPS Simulators

           AWL L„nge max 500 Zeilen
           8 Ausg„nge ( A1 - A8 ) (Port B der PIO)
           8 Eing„nge ( E1 - E8 ) (Port A der PIO)
           8 Z„hler   ( Z1 - Z8 ) (Port C der PIO)
           8 Timer    ( T1 - T8 ) *
           64 Marker  ( M1 - M64) davon M64 = Takt mit 2*Tz
                                        M63 = Takt mit 4*Tz
                                        M62 = Takt mit 8*Tz

           Die Pio muá mit einem 8255 aufgebaut sein und
           die Adressen 300h-303h haben.
           Derartige PIO's wurden schon in vielen Fachzeit-
           schriften zum Selbstbau vorgestellt.
           (z.B. ELEKTOR 7/8 1989)

           Alle Ein- und Ausg„nge haben TTL Pegel.
           Berechnng der Verz”gerung der Timer mit der Formel:
           t= K * Tz
           Die Zykluszeit Tz kann auch genauer bestimmt werden,
           wenn man M64 auf einen Ausgang legt und die Frequenz
           mit einem Oszi miát.
           die Zykluszeit ist dann Tz=2/f.



      3.2 Konfiguration

           Ab der Version 1.2 ist die M”glichkeit der Konfiguration
           ber ein File gegeben.
           Dieses File muá :
                1. SPS.CFG heiáen
                2. im gleichen Verzeichnis sein wie SPS.EXE

           šber das Config-File k”nnen folgende Einstellungen vor-
           genommen werden:
                1. PIO-Daten
                2. Druckersteuercodes

      3.2.1 Aufbau des Config-Files

           Folgende Zeilen mssen im Config-File vorhanden sein:

          Kurz-    Bedeutung                    Erlauterung
          zeichen

             c     control_port
             e     eing„nge
             a     ausg„nge
             z     z„hler
             v     vorschub                      - Zeilenvorschub
             g     grosschrift                   - Groáschrift f. 1 Zeile
             l     l„nge                         - L„nge einer Seite
             f     formfeed                      - Seitenvorschub

          Erkl„rung:
              die 1. vier Zeilen beziehen sich auf die Adressen der Pio.	    
              Hinter dem Gleichheitszeichen mssen die Adressen ange-
              geben werden unter denen der jeweilige Port angesprochen
              wird. Die Adressangaben mssen dabei in dezimaler Form
              erfolgen. Ist keine Pio im System installiert, muá hier
              trotzdem eine Adressangabe stehen, die natrlich nicht
              mit einer vorhandenen Hardware kollidieren darf.
              z.B. 768-771 wenn kein Prototypenadapter installiert ist.
              die letzten 4 zeilen beziehen sich auf die Steuerung des
              Druckers. Auch hier muá in dezimaler Form der jeweilige
              Steuercode angegeben werden. ( siehe Druckerhandbuch )


           Beispiel:    Standart SPS.CFG fuer StarNL10 und Pio

           c771         Kontrollport der Pio
           e768         PortA
           a769         PortB
           z770         PortC
           v10          Vorschubzeichen fuer Drucker
           g14          Grosschrift ein
           l60          Seitenlaenge
           f12          Zeichen fuer Formfeed

      4. Beispiele zur Syntax

      4.1 der UND Befehl und die Zuweisung:

            Folgende einfache Schaltung soll in eine AWL umgesetzt
            werden:
                     _____
            E1------!     !
            E2------!  &  !----A1      A1=E1*E2*E3
            E3------!_____!

            Es ergibt sich folgende AWL: 
                  1 U   E  1
                  2 U   E  2
                  3 U   E  3
                  4 =   A  1
                  5 EN

            Erlaeuterung:  Bei Start der AWL wird das in 3. als Akku
                  bezeichnete Register mit einer log. 1 geladen.
                  Durch die Anweisung U E 1 wird dieser Akkuinhalt
                  mit dem Wert des  Einganges E 1  UND verknpft.
                  Das Ergebnis wird wieder im Akku gespeichert. Das
                  bedeutet der Zustand des Einganges E1 wurde in den 
                  Akku bernommen, denn nach den Regeln der Boolschen
                  Algebra ergibt E1 * 1 = E1.
                  Dieser Akkuinhalt wird dann in Zeile 2 mit dem Wert 
                  von E2 UND verknpft und anschlieáend  wird dieses
                  Ergebnis (der Akkuinhalt) mit E3 UND verknpft.
                  In Zeile 4 wird dieses Ergebnis dem Ausgang A1 zuge-
                  wiesen.
                  Zeile 5 EN zeigt dem Simulator daá er am Ende der
                  AWL angekommen ist und nun wieder mit Zeile 1
                  beginnen muá.
                  Man sieht hier deutlich, daá sich alle Operationen
                  immer auf den Akkuinhalt beziehen.

                  Wird Zeile 4 in "4 =N  A  1" ge„ndert ergibt sich
                  folgende Schaltung:

                     _____
            E1------!     !               ________
            E2------!  &  !o---A1      A1=E1*E2*E3
            E3------!_____!

                  denn der Akkuinhalt wird vor der Zuweisung negiert.


      4.2 Die ODER Verknpfung:

            Versuchen Sie jetzt doch einmal die folgende Schaltung:

                     _____
            E1------!     !                        
            E2------!  ò  !----A1      A1=E1+E2+E3
            E3------!_____!

            Wahrscheinlich sieht Ihre L”sung so aus:

                  1 O   E  1
                  2 O   E  2
                  3 O   E  3
                  4 =   A  1
                  5 EN

                  Diese L”sung ist jedoch falsch !
                  Warum ? 
                  In Zeile 1 steckt der Fehler, denn wie weiter
                  oben erl„utert wird bei jedem Durchlauf der
                  AWL zu Beginn der Akku mit dem Wert 1 geladen.
                  Aus der Boolschen Algebra ergibt sich aber
                  E1 + 1 = 1
                  Daher haben wir jetzt folgendes Ergebnis:
                  1+E2+E3= A1 was bedeutet A1 ist immer 1.

                  Richtig muá es daher lauten:

                  1 U   E  1
                  2 O   E  2
                  3 O   E  3
                  4 =   A  1
                  5 EN

                  Sie sollten sich daher merken, jeden Satzanfang
                  (Start der AWL oder 1.Zeile nach einer Zuweisung)
                  muessen Sie mit U .. beginnen damit der AKKU 
                  korrekt geladen wird.

                  Probieren Sie das ruhig alles mal aus.

      4.3  Klammeroperation :

            In der Liste der Befehle haben Sie sicher auch die Klammer-
            Befehle gesehen.
            Im folgenden erl„utere ich kurz ihre Syntax.
            Dazu betrachten wir folgende AWL:

                  1 U   E  1
                  2 O(  
                  3 U   E  2
                  4 U   E  3
                  5 )
                  6 =   A  1
                  7 EN

            Versuchen wir das ganze mal aufzudr”seln:
            In Zeile 1 wird E1 in den Akku geladen. Ab 2 passiert
            nun folgendes: der Inhalt des Akkus wird mit dem Er-
            gebnis der Klammeroperation ODER verknpft, und dann
            dem Ausgang A1 zugewiesen. Eigentlich noch ganz klar
            und nachvollziehbar. Dabei muá jedoch eines bercksichtigt
            werden: 
                    Beim ™ffnen der Klammer wird der Zustand des 
                    Akkus intern gespeichert und er wird wieder
                    auf 1 gesetzt. Das heiát in zeile 3 haben wir 
                    wieder eine Verknpfung 1*E2=E2 ,also eine 
                    Ladeanweisung. Erst beim Schlieáen der Klammer
                    wird der gespeicherte Akkuinhalt im dem aktuellen
                    Akkuinhalt ODER verknpft und dann A1 zugewiesen.

                    Die Schaltung sieht also so aus:
                              _____
            E1---------------!     !                 
                  _____      !  ò  !---A1
            E2---!     !  !--!_____!
                 !  &  !--!                
            E3---!_____!


            Probieren Sie jetzt selber einmal mit den verschiedenen
            Verknpfungen U / UN / U( / UN( / O / ON / O( / ON(
            einfache Funktionen aus .

            Vor allem eines beachten :
                  Diese Ausfhrungen sollen Ihnen nur erl„utern wie
                  dieser Simulator arbeitet. Mehr ber SPS und
                  die Programmierung erfahren Sie in der Literatur
                  rund um das Thema SPS und den Beispielen.
                  Beachten Sie die *.doc Dateien zu den Beispielen!!


 Der Programmierer weisst Ausdruecklich darauf hin, dass er weder
 fuer direkte oder indirekte Schaeden, die aus oder durch die 
 Benutzung der Software enstanden sind Haftbar gemacht werden kann.


 ACHTUNG: Benutzung des SPS Simulators unter Windows !!!
          Der SPS Simulator funktioniert natuerlich auch unter
          Windows (siehe PIF Datei).
          Sie muessen jedoch beachten, dass unter Windows
              1. die Zykluszeit nicht konstant ist (Multitasking!!!)
              2. der Simulator jederzeit durch gleichzeitigen Start
                 einer Exklusiven DOS Aplikation angehalten werden
                 kann!! ( wehe der angeschlossenen Steuerung)
                 Sie sollten daher nur im INTERNEN Modus unter 
                 WINDOWS arbeiten.
 Beachten Sie die Hinweise zur Installation von Dos Aplikationen
 in Ihrer Windows Dokumentation! 



